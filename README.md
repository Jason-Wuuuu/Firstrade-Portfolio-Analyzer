# Firstrade Portfolio Analysis

## Table of Contents

- [Introduction](#introduction)
- [Files](#files)
- [Interactive Visualizations](#interactive-visualizations)
- [Sample Visualizations](#sample-visualizations)
- [Outputs](#outputs)
  - [transaction_history.json Structure](#transaction_historyjson-structure)
  - [portfolio_history.json Structure](#portfolio_historyjson-structure)
- [Setup](#setup)
- [Usage](#usage)
- [Features](#features)
- [Note](#note)

## Introduction

This project offers a comprehensive suite of Python scripts and a Jupyter notebook for in-depth analysis and visualization of your Firstrade investment portfolio. By meticulously reconstructing your complete transaction history from the Firstrade CSV file, it enables:

- Precise tracking of your portfolio's evolution from the very first trade
- Detailed performance analysis over any time period
- Accurate calculation of returns, including the compounding effects of dividends and reinvestments
- Proper handling of corporate actions like stock splits
- Insights into how different transaction types have impacted your overall performance

## Files

1. **portfolio_analysis_dashboard.ipynb**:
   This Jupyter notebook provides an interactive dashboard for analyzing your portfolio. It visualizes portfolio composition, performance metrics, and historical trends using interactive Plotly charts.

2. **transaction_history_processor.py**:
   This Python script processes the transaction history from Firstrade, calculates portfolio states, and provides methods for viewing and saving portfolio data.

3. **ft_history_processor.py**:
   This script handles the initial processing of the Firstrade CSV history file, converting it into a structured JSON format for further analysis.

## Interactive Visualizations

The dashboard now features interactive Plotly charts, allowing for:

- Zooming and panning on all charts
- Hovering over data points for detailed information
- Comparing portfolio performance against S&P 500 benchmark
- Adjustable date ranges for focused analysis
- Sector breakdown with detailed stock information on hover

## Sample Visualizations

<div style="display: flex; flex-direction: column; align-items: center;">
  <img src="./outputs/output1.png" alt="Portfolio Performance vs S&P 500" style="max-width: 100%; height: auto; margin-bottom: 20px;">
  <img src="./outputs/output2.png" alt="Individual Stock Performance Comparison" style="max-width: 100%; height: auto;">
</div>

These visualizations are examples of the interactive charts generated by the Jupyter notebook. They provide insights into overall portfolio performance and individual stock contributions.

## Outputs

The scripts generate two main output files:

- `transaction_history.json`: Processed transaction data
- `portfolio_history.json`: Calculated portfolio states with market data

### transaction_history.json Structure

The `transaction_history.json` file contains a detailed record of all transactions processed from the Firstrade CSV file. Here's an overview of its structure:

The file is organized by date, with each date containing the following transaction categories:

1. `buy`: Stock purchases, organized by symbol. Each purchase includes quantity, price, and total amount.

2. `sell`: Stock sales, organized by symbol. Each sale includes quantity, price, and total amount.

3. `reinvestment`: Dividend reinvestments, organized by symbol. Each reinvestment includes quantity, price, and total amount.

4. `split`: Stock splits, organized by symbol. Each split records the additional quantity received.

5. `deposit`: Total cash deposits for the day.

6. `interest`: Total interest earned for the day.

7. `dividend`: Total dividends received for the day.

If no transactions occurred in a particular category on a given date, that category may be omitted from the JSON structure for that date. This structure provides a comprehensive view of all transaction activities, allowing for easy analysis and reconciliation with the portfolio history.

```json
{
  "2023-05-15": {
    "buy": {
      "AAPL": [
        {
          "quantity": 10,
          "price": 150.0,
          "amount": 1500.0
        }
      ]
    },
    "sell": {
      "GOOGL": [
        {
          "quantity": 5,
          "price": 2500.0,
          "amount": 12500.0
        }
      ]
    },
    "reinvestment": {
      "SPY": [
        {
          "quantity": 1.5,
          "price": 400.0,
          "amount": 600.0
        }
      ]
    },
    "split": {
      "TSLA": {
        "quantity": 2
      }
    },
    "deposit": 5000.0,
    "interest": 10.5,
    "dividend": 100.0
  },
  "2023-05-16": {
    // Similar structure for another date
  }
  // ... more dates
}
```

### portfolio_history.json Structure

The `portfolio_history.json` file contains a detailed record of your portfolio's state over time. Here's an overview of its structure:

The file contains a version number, a timestamp of when it was generated, and two main sections:

1. `sectors`: Maps stock symbols to their respective sectors.

2. `portfolios`: Contains the portfolio state for each date, with dates as keys. For each date, there are three main components:

   a. `summary`: Overall portfolio metrics including total market value, cash, invested value, cost basis, unrealized gains/losses, daily performance, and total deposits.

   b. `holdings`: Details for each stock held, including quantity, cost basis, current market value, unrealized gains/losses, and daily performance.

   c. `closed_positions`: Information about stocks that were sold, including quantity, sell price, cost basis, and realized gain.

All numerical values are stored as strings to preserve precision. This structure allows for easy access to portfolio data for any given date, making it suitable for further analysis or visualization.

```json
{
  "version": "1.0",
  "timestamp": "2023-05-15T12:34:56.789012",
  "sectors": {
    "AAPL": "Technology",
    "GOOGL": "Communication Services",
    "SPY": "ETF"
    // ... other symbols and their sectors
  },
  "portfolios": {
    "2023-05-15": {
      "summary": {
        "total_market_value": "100000.00",
        "cash": "5000.00",
        "invested_value": "95000.00",
        "total_cost_basis": "90000.00",
        "unrealized_gain_loss": "5000.00",
        "unrealized_gain_loss_percentage": "5.56",
        "daily_gain": "500.00",
        "daily_return": "0.0050",
        "total_deposits": "95000.00"
      },
      "holdings": {
        "AAPL": {
          "quantity": "100.00",
          "total_cost": "15000.00",
          "unit_cost": "150.00",
          "market_price": "160.00",
          "market_value": "16000.00",
          "unrealized_gain_loss": "1000.00",
          "unrealized_gain_loss_percentage": "6.67",
          "daily_gain": "200.00",
          "daily_return": "0.0125"
        }
        // ... other holdings
      },
      "closed_positions": {
        "GOOGL": [
          {
            "quantity": "10.00",
            "sell_price": "2500.00",
            "cost_basis": "2400.00",
            "realized_gain": "1000.00"
          }
        ]
        // ... other closed positions
      }
    }
    // ... portfolio data for other dates
  }
}
```

## Setup

1. Install required packages:

   ```
   pip install -r requirements.txt
   ```

2. Download your transaction history from Firstrade as a CSV file and rename it to `FT_History.csv`. Place this file in the same directory as the scripts.

## Usage

1. Run the `ft_history_processor.py` script to convert the CSV file to a JSON format:

   ```
   python ft_history_processor.py
   ```

2. Run the `transaction_history_processor.py` script to process the JSON data and calculate portfolio states:

   ```
   python transaction_history_processor.py
   ```

3. Open the `portfolio_analysis_dashboard.ipynb` notebook in Jupyter Lab or Jupyter Notebook to interact with the dashboard and analyze your portfolio.

## Features

- Transaction history processing from CSV to JSON
- Portfolio state calculation and historical tracking
- Integration with yfinance for fetching market data
- Interactive Plotly visualizations of portfolio composition and performance
- Analysis of individual stock performance within the portfolio
- Comparison of portfolio performance against S&P 500 benchmark

## Note

Ensure that your Firstrade history file (`FT_History.csv`) is up to date for the most accurate analysis. The scripts and notebook use this file as the primary data source for all calculations and visualizations.
